<!DOCTYPE html>
<html>
<head>
    <title>Pokemon Stat Game</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: #f0f0f0;
            height: 100vh;
            margin: 0;
        }
        .score-container {
            font-size: 24px;
            margin: 20px;
            display: flex;
            gap: 20px;
        }
        .stat-display {
            font-size: 20px;
            margin: 10px;
        }
        .pokemon-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin: 20px;
            width: 100%;
            max-width: 400px;
            height: auto;
            aspect-ratio: 1 / 1;
            flex-grow: 1;
            justify-content: center;

        }
        .pokemon-card {
            border: 3px solid #333;
            border-radius: 10px;
            padding: 10px;
            background-color: white;
            cursor: pointer;
            transition: transform 0.2s, left 0.3s ease, right 0.3s ease; /* Combined transition */
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            gap: 20px;
            position: relative;
        }
        .pokemon-card:hover {
            transform: scale(1.05);
        }
        .pokemon-image {
            width: 200px;
            height: 200px;
            object-fit: contain;
        }
        .pokemon-name {
            text-align: center;
            font-size: 18px;
            margin-top: 10px;
        }
        .message {
            font-size: 24px;
            margin: 20px;
            height: 30px;
            text-align: center;
        }
        .stats-container {
            display: flex;
            flex-direction: column;
            gap: 5px;
            position: relative;
            width: 100%;
            max-width: 400px;
            height: auto;
            aspect-ratio: 1 / 1;
            flex-grow: 1;
        }
        .stat-row {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .stat-bar {
            width: 200px;
            height: 20px;
            background-color: #ddd;
            position: relative;
        }
        .stat-fill {
            height: 100%;
            transition: width 0.5s ease-in-out;
        }
        .stat-label {
            width: 40px;
            text-align: right;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="score-container">
        <div>Score: <span id="score">0</span></div>
        <div>High Score: <span id="high-score">0</span></div>
    </div>
    <div class="stat-display">Which Pokémon has higher <span id="current-stat"></span>?</div>
    <div class="pokemon-container">
        <div class="pokemon-card" data-index="0">
            <div>
                <img class="pokemon-image" src="" alt="Pokemon Top">
                <div class="pokemon-name"></div>
            </div>
           
        </div>
        <div class="pokemon-card" data-index="1">
            <div>
                <img class="pokemon-image" src="" alt="Pokemon Bottom">
                <div class="pokemon-name"></div>
            </div>
        </div>
    </div>
    <div class="message" id="message"></div>
    <script>
        // <div class="stats-container" id="stats-0"></div> put back later
        //transition: transform 0.2s;
        let currentPokemon = [];
        let currentStat = '';
        let score = 0;
        let highScore = 0;
        let isClickable = true;
        let roundsAppeared = [0, 0];

        async function fetchPokemonData(id) {
            const response = await fetch(`https://pokeapi.co/api/v2/pokemon/${id}`);
            const data = await response.json();
            return {
                id: data.id,
                name: data.name,
                image: data.sprites.front_default,
                stats: data.stats.reduce((acc, stat) => {
                    acc[stat.stat.name] = stat.base_stat;
                    return acc;
                }, {}),
            };
        }

        function getRandomPokemonId() {
            return Math.floor(Math.random() * 898) + 1;
        }

        function selectNewStat() {
            const stats = ['hp', 'attack', 'defense', 'special-attack', 'special-defense', 'speed'];
            return stats[Math.floor(Math.random() * stats.length)];
        }

        function getStatColor(value) {
            if (value < 80) return '#ff0000'; // Red
            if (value <= 100) return '#ff8000'; // Orange
            if (value <= 120) return '#00ff00'; // Lime Green
            return '#008000'; // Green
        }

        function createStatsDisplay(index) {
            const statContainer = document.createElement("div");
            statContainer.classList.add("stats-container"); // Adjust class name if needed
            const statsOrder = ['hp', 'attack', 'defense', 'special-attack', 'special-defense', 'speed'];
            const labels = ['HP', 'Atk', 'Def', 'SpA', 'SpD', 'Spe'];

            statsOrder.forEach((stat, i) => {
                const value = currentPokemon[index].stats[stat];

                const row = document.createElement('div');
                row.className = 'stat-row';

                const label = document.createElement('div');
                label.className = 'stat-label';
                label.textContent = `${labels[i]}: ${value}`;

                const bar = document.createElement('div');
                bar.className = 'stat-bar';

                const fill = document.createElement('div');
                fill.className = 'stat-fill';
                fill.style.width = `${(value / 255) * 100}%`;
                fill.style.backgroundColor = getStatColor(value);

                bar.appendChild(fill);
                row.appendChild(label);
                row.appendChild(bar);
                statContainer.appendChild(row);
            });

            const card = document.querySelectorAll('.pokemon-card')[index];
            card.appendChild(statContainer);

            // Transition effect (move in and fade)
            statContainer.style.transition = 'transform 0.3s ease, opacity 0.3s ease';
            statContainer.style.transform = 'translateX(-100%)';
            statContainer.style.opacity = '0';

            setTimeout(() => {
                statContainer.style.transform = 'translateX(0)';
                statContainer.style.opacity = '1';
            }, 10);
        }


        function updateDisplay(showStats = false, keepIndex = -1) { //
            document.querySelectorAll('.pokemon-card').forEach((card, index) => {
                const pokemon = currentPokemon[index];
                card.querySelector('.pokemon-image').src = pokemon.image;
                card.querySelector('.pokemon-name').textContent = pokemon.name.charAt(0).toUpperCase() + pokemon.name.slice(1);
                if (showStats) {
                    createStatsDisplay(index);
                }/* else if (index !== keepIndex) {
                    document.getElementById(`stats-${index}`).innerHTML = '';
                }*/
            });
            document.getElementById('current-stat').textContent = currentStat.replace('-', ' ');
            document.getElementById('score').textContent = score;
            document.getElementById('high-score').textContent = highScore;
        }
        
        function moveCards(moved = false, reverse = false) {
            const card1 = document.querySelector('div.pokemon-card[data-index="0"]');
            const card2 = document.querySelector('div.pokemon-card[data-index="1"]');

            if (moved) {
                // Move the cards further to the left (by 400px) using translateX
                card1.style.transform = "translateX(-225px) translateY(338px)";
                card2.style.transform = "translateX(+225px) translateY(-338px)";
                // Call the function to log the positions
            } else if (reverse) {
                // Move the cards back to the original position
                card1.style.transform = "translateX(0) translateY(0)";
                card2.style.transform = "translateX(0) translateY(0)"; //origy = 486
            }
        }
        
        function moveStatContainers(remove = false) {
            const statContainers = document.querySelectorAll('.stats-container');

            statContainers.forEach((container) => {
                if (remove) {
                    // Apply transition to remove
                    container.style.transform = 'translateX(100%)';
                    container.style.opacity = '0';
                    setTimeout(() => container.remove(), 300); // Remove after transition
                } else {
                    container.style.transform = 'translateX(0)';
                    container.style.opacity = '1';
                }
            });
        }

        async function initializeGame() {
            currentPokemon = [
                await fetchPokemonData(getRandomPokemonId()),
                await fetchPokemonData(getRandomPokemonId())
            ];
            currentStat = selectNewStat();
            updateDisplay();
            

            document.querySelectorAll('.pokemon-card').forEach(card => {
                card.addEventListener('click', async (e) => {
                    if (!isClickable) return;
                    isClickable = false;
                    
                    const selectedIndex = parseInt(card.dataset.index);

                    const valueSelected = currentPokemon[selectedIndex].stats[currentStat];
                    const valueOther = currentPokemon[1 - selectedIndex].stats[currentStat];

                    let message = '';
                    if (valueSelected >= valueOther) {
                        score++;
                        message = `Correct! ${currentPokemon[selectedIndex].name}: ${valueSelected}, ${currentPokemon[1 - selectedIndex].name}: ${valueOther}`;
                    } else {
                        message = `Incorrect! ${currentPokemon[selectedIndex].name}: ${valueSelected}, ${currentPokemon[1 - selectedIndex].name}: ${valueOther}`;
                        score = 0;
                    }

                    highScore = Math.max(highScore, score);
                    document.getElementById('message').textContent = message;
                    document.getElementById('score').textContent = score;
                    document.getElementById('high-score').textContent = highScore;
                    
                    setTimeout(async () => {
                        moveCards(true,false)
                        moveStatContainers(false);
                    }, 200);
                    
                    updateDisplay(true); // Show stats for both
                    setTimeout(async () => {

                            document.getElementById('message').textContent = '';

                            const higherIndex = valueSelected >= valueOther ? selectedIndex : 1 - selectedIndex;
                            const lowerIndex = 1 - higherIndex;

                            if (roundsAppeared[higherIndex] >= 2) {
                                currentPokemon[higherIndex] = await fetchPokemonData(getRandomPokemonId());
                                roundsAppeared[higherIndex] = 0;
                                // If the higher Pokémon is replaced, don't keep its stats
                                //updateDisplay(false, -1);
                            } else {
                                roundsAppeared[higherIndex]++;
                                // Keep the stats of the higher Pokémon
                                currentPokemon[lowerIndex] = await fetchPokemonData(getRandomPokemonId());
                                roundsAppeared[lowerIndex] = 0;
                                //updateDisplay(false, higherIndex);
                            }
                            //updateDisplay(false)
                            currentStat = selectNewStat();
                            isClickable = true;
                            moveStatContainers(true);
                            moveCards(false,true)
                    }, 4000);
                });
            });
        }

        initializeGame();
    </script>
</body>
</html>
